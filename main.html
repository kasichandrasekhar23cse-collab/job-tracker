<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quantum Jobs Tracker</title>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #0f1621;
      --muted: #a3b3c6;
      --text: #e6eef8;
      --accent: #61dafb;
      --ok: #28a745;
      --warn: #e0a800;
      --err: #e5534b;
      --chip: #1b2636;
      --border: #1e2a3a;
      --shadow: 0 8px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 10% -10%, #122036 0%, #0b0f14 60%);
      color: var(--text);
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 20px; }
    .title { display: flex; align-items: center; gap: 12px; }
    .logo { width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #00d4ff, #0077ff); box-shadow: var(--shadow); }
    h1 { font-size: 22px; margin: 0; letter-spacing: .2px; }
    .sub { color: var(--muted); font-size: 13px; }

    .panel { background: linear-gradient(180deg, #111a27, #0d141f); border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); }
    .controls { display: grid; grid-template-columns: 1.2fr 1fr 1fr 1fr auto; gap: 12px; padding: 14px; align-items: center; }
    .controls .group { background: var(--chip); border: 1px solid var(--border); border-radius: 12px; display: flex; align-items: center; gap: 8px; padding: 8px 10px; }
    .controls input, .controls select { width: 100%; background: transparent; border: none; outline: none; color: var(--text); font-size: 14px; }
    .controls label { font-size: 12px; color: var(--muted); }

    .btn { background: linear-gradient(180deg, #1d2a3e, #172337); border: 1px solid var(--border); color: var(--text); padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; letter-spacing: .2px; }
    .btn:hover { filter: brightness(1.08); }

    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px; }
    @media (max-width: 980px){ .grid { grid-template-columns: 1fr; } .controls { grid-template-columns: 1fr 1fr 1fr; } }

    .stat-card { padding: 16px; display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; }
    .stat-title { color: var(--muted); font-size: 12px; }
    .stat-value { font-size: 28px; font-weight: 800; letter-spacing: .5px; }
    .chip { padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); background: var(--chip); font-size: 12px; color: var(--muted); display: inline-flex; gap: 6px; align-items: center; }

    .section { margin-top: 18px; display: grid; grid-template-columns: 1.1fr 2fr; gap: 16px; }
    @media (max-width: 980px){ .section { grid-template-columns: 1fr; } }

    .device-list { padding: 10px; }
    .device { display: grid; grid-template-columns: 1fr auto auto; gap: 10px; align-items: center; border-bottom: 1px dashed var(--border); padding: 12px 6px; }
    .device:last-child { border-bottom: none; }
    .device .name { font-weight: 600; }
    .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }

    .table-wrap { overflow: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid var(--border); padding: 12px 10px; text-align: left; font-size: 14px; }
    th { color: var(--muted); font-weight: 600; position: sticky; top: 0; background: #0e1623; }
    tr:hover td { background: rgba(255,255,255,.02); }

    .status { font-weight: 700; font-size: 12px; padding: 6px 8px; border-radius: 8px; display: inline-block; }
    .st-DONE { background: rgba(40,167,69,.1); color: var(--ok); border: 1px solid rgba(40,167,69,.3); }
    .st-RUNNING { background: rgba(0,123,255,.1); color: #4da3ff; border: 1px solid rgba(0,123,255,.3); }
    .st-QUEUED { background: rgba(224,168,0,.1); color: var(--warn); border: 1px solid rgba(224,168,0,.3); }
    .st-FAILED { background: rgba(229,83,75,.1); color: var(--err); border: 1px solid rgba(229,83,75,.3); }

    .right { text-align: right; }

    /* Modal */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,.6); display: none; align-items: center; justify-content: center; padding: 20px; }
    .modal.open { display: flex; }
    .modal-card { width: min(760px, 96vw); background: #0e1521; border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); }
    .modal-head { display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; border-bottom: 1px solid var(--border); }
    .modal-body { padding: 16px; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: #0b1120; border: 1px solid var(--border); color: #d9e5f7; padding: 2px 6px; border-radius: 6px; }

    canvas { background: #0c121c; border: 1px solid var(--border); border-radius: 10px; }

    footer { margin-top: 18px; color: var(--muted); font-size: 12px; text-align: center; }
  </style>
</head>
<body>
<div class="container">
<header>
  <div class="title">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>Quantum Jobs Tracker</h1>
      <div class="sub">Monitor live/public IBM Quantum jobs • Problem ID: AQVH915</div>
    </div>
  </div>
  <button id="refreshBtn" class="btn">⟳ Refresh</button>
</header>

<div class="panel controls">
  <div class="group">
    <label for="search">Search</label>
    <input id="search" placeholder="Job ID, circuit, user…" />
  </div>
  <div class="group">
    <label for="status">Status</label>
    <select id="status">
      <option value="">Any</option>
      <option>QUEUED</option>
      <option>RUNNING</option>
      <option>DONE</option>
      <option>FAILED</option>
    </select>
  </div>
  <div class="group">
    <label for="backend">Backend</label>
    <select id="backend"><option value="">Any</option></select>
  </div>
  <div class="group">
    <label for="interval">Auto-refresh</label>
    <select id="interval">
      <option value="0">Off</option>
      <option value="10">10s</option>
      <option value="30">30s</option>
      <option value="60">60s</option>
    </select>
  </div>
  <div style="justify-self:end"><span class="chip" id="lastUpdated">Last updated: —</span></div>
</div>

<div class="grid">
  <div class="panel stat-card">
    <div>
      <div class="stat-title">Total Jobs (visible)</div>
      <div class="stat-value" id="totalJobs">0</div>
    </div>
    <div>
      <div class="chip">DONE: <span id="doneCnt">0</span></div>
      <div class="chip" style="margin-left:8px">RUNNING: <span id="runCnt">0</span></div>
      <div class="chip" style="margin-left:8px">QUEUED: <span id="queueCnt">0</span></div>
    </div>
  </div>
  <div class="panel stat-card">
    <div>
      <div class="stat-title">Average Queue (mins)</div>
      <div class="stat-value" id="avgQueue">0.0</div>
    </div>
    <div class="chip">Across backends</div>
  </div>
</div>

<div class="section">
  <div class="panel">
    <div style="display:flex; justify-content:space-between; align-items:center; padding: 12px 14px; border-bottom:1px solid var(--border);">
      <strong>Backend Status</strong>
      <span class="chip">Devices: <span id="deviceCount">0</span></span>
    </div>
    <div class="device-list" id="deviceList"></div>
  </div>

  <div class="panel">
    <div style="display:flex; justify-content:space-between; align-items:center; padding: 12px 14px; border-bottom:1px solid var(--border);">
      <strong>Jobs</strong>
      <span class="chip"><span class="dot" id="liveDot" style="background:#777"></span>&nbsp;Live</span>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Job ID</th>
            <th>Backend</th>
            <th>Status</th>
            <th class="right">Qubits</th>
            <th>Circuit</th>
            <th>Submitted</th>
            <th class="right">Queue (m)</th>
            <th class="right">Runtime (s)</th>
          </tr>
        </thead>
        <tbody id="jobsBody"></tbody>
      </table>
    </div>
  </div>
</div>

<div class="panel" style="margin-top:16px; padding: 12px 14px;">
  <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
    <strong>Job Status Distribution</strong>
    <span class="chip">visual</span>
  </div>
  <canvas id="statusChart" width="900" height="220" aria-label="bar chart of job statuses"></canvas>
</div>

<footer>
  Built with vanilla HTML/CSS/JS. Uses mock data by default. Toggle a backend endpoint in code when ready.
</footer>
</div>

<!-- Job Details Modal -->
<div class="modal" id="jobModal" role="dialog" aria-modal="true" aria-labelledby="jobModalTitle">
  <div class="modal-card">
    <div class="modal-head">
      <div>
        <div id="jobModalTitle" style="font-weight:800">Job Details</div>
        <div class="sub" id="jobModalSubtitle">—</div>
      </div>
      <button class="btn" id="closeModal">✕ Close</button>
    </div>
    <div class="modal-body" id="jobModalBody">
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <div class="panel" style="padding:12px">
          <div class="stat-title">Job Metadata</div>
          <div id="jobMeta" style="margin-top:6px"></div>
        </div>
        <div class="panel" style="padding:12px">
          <div class="stat-title">Result Preview</div>
          <pre class="kbd" id="jobResult" style="white-space: pre-wrap; margin-top:6px;">—</pre>
        </div>
      </div>
      <div style="margin-top:12px">
        <strong>Quantum Circuit</strong>
        <canvas id="modalCircuit" width="400" height="80"></canvas>
      </div>
    </div>
  </div>
</div>

<script>
const USE_BACKEND = false;
const BASE_URL = "/api";

const qs = (s, el=document) => el.querySelector(s);
const qsa = (s, el=document) => Array.from(el.querySelectorAll(s));
const fmtDate = ts => new Date(ts).toLocaleString();

const state = {
  jobs: [], devices: [], filters: {search:'', status:'', backend:''}, timer:null
};

const MockAPI = {
  async listBackends(){ await sleep(200); return [
    { name:"ibm_oslo", qubits:5, status:"online", queue:randInt(0,20)},
    { name:"ibm_perth", qubits:7, status:"online", queue:randInt(0,30)},
    { name:"ibmq_qasm_simulator", qubits:32, status:"online", queue:randInt(0,5)},
    { name:"ibm_kyoto", qubits:127, status:Math.random()>.15?"online":"offline", queue:randInt(0,120)},
  ];},
  async listJobs(){ await sleep(300);
    const backends = ["ibm_oslo","ibm_perth","ibmq_qasm_simulator","ibm_kyoto"];
    const statuses = ["QUEUED","RUNNING","DONE","FAILED"];
    const now = Date.now();
    return Array.from({length:28}).map((_,i)=>{
      const backend = backends[i % backends.length];
      const status = statuses[(i*7 + randInt(0,3)) % statuses.length];
      const submitted = now - randInt(2,180)*60*1000;
      const queueMin = status==="QUEUED"? randInt(1,60): randInt(0,5);
      const runtime = status==="DONE"? randInt(2,90):(status==="FAILED"?randInt(1,10):0);
      const qubits = backend==="ibm_kyoto"? randInt(20,120):backend==="ibmq_qasm_simulator"?randInt(5,32):randInt(3,7);
      return { id:`JOB-${(100000+i+randInt(0,999)).toString(36).toUpperCase()}`, backend,status,qubits,submitted,queueMin,runtime,
        user:["alice","bob","charlie","diana"][i%4],
        circuit:`circuit_${(i%9)+1}`,
        result: status==="DONE"?{counts:sampleCounts(qubits)}:(status==="FAILED"?{error:"Device calibration drift"}:null)
      }
    });
  },
  async getJob(jobId){ const list=await this.listJobs(); return list.find(j=>j.id===jobId)||list[0]; }
};

async function api(path){ 
  if(USE_BACKEND) return fetch(BASE_URL+path).then(r=>r.json());
  if(path==="/backends") return MockAPI.listBackends();
  if(path==="/jobs") return MockAPI.listJobs();
  return {};
}

function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function sampleCounts(q){ const c={}; for(let i=0;i<Math.min(8,1<<q);i++) c[(i).toString(2).padStart(q,'0')]=randInt(1,100); return c; }
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

function drawCircuit(canvas, circuitName, qubits){
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle = '#61dafb';
  ctx.lineWidth = 2;

  const margin = 10;
  const spacing = (canvas.height - 2*margin) / Math.max(qubits,1);

  // qubit lines
  for(let i=0;i<qubits;i++){
    ctx.beginPath();
    ctx.moveTo(margin, margin + i*spacing);
    ctx.lineTo(canvas.width - margin, margin + i*spacing);
    ctx.stroke();
  }

  // gates
  for(let i=0;i<Math.min(4, qubits);i++){
    const x = margin + i*20 + 10;
    const y = margin + i*spacing - 6;
    ctx.fillStyle = '#4da3ff';
    ctx.fillRect(x, y, 12, 12);
  }

  ctx.fillStyle = '#61dafb';
  ctx.font = '10px monospace';
  ctx.fillText(circuitName, 2, canvas.height - 2);
}

async function refresh(){
  const [backends, jobs] = await Promise.all([api("/backends"), api("/jobs")]);
  state.devices = backends; state.jobs = jobs;
  renderBackends(); renderJobs();
  qs('#lastUpdated').textContent = "Last updated: " + fmtDate(Date.now());
}

function renderBackends(){
  const list = qs('#deviceList'); list.innerHTML='';
  state.devices.forEach(d=>{
    const div = document.createElement('div');
    div.className='device';
    div.innerHTML=`<div class="name">${d.name} (${d.qubits} qubits)</div>
      <div><span class="dot" style="background:${d.status==="online"?"#28a745":"#e5534b"}"></span> ${d.status}</div>
      <div class="right">${d.queue} jobs</div>`;
    list.appendChild(div);
  });
  qs('#deviceCount').textContent = state.devices.length;
}

function renderJobs(){
  const tbody = qs('#jobsBody'); tbody.innerHTML='';
  let filtered = state.jobs.filter(j=>{
    return (!state.filters.search || j.id.includes(state.filters.search) || j.circuit.includes(state.filters.search) || j.user.includes(state.filters.search)) &&
           (!state.filters.status || j.status===state.filters.status) &&
           (!state.filters.backend || j.backend===state.filters.backend);
  });

  filtered.forEach(j=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><a href="#" onclick="openJobModal('${j.id}')">${j.id}</a></td>
      <td>${j.backend}</td>
      <td><span class="status st-${j.status}">${j.status}</span></td>
      <td class="right">${j.qubits}</td>
      <td><canvas width="100" height="40" class="circuitCanvas" data-circuit="${j.circuit}"></canvas></td>
      <td>${fmtDate(j.submitted)}</td>
      <td class="right">${j.queueMin}</td>
      <td class="right">${j.runtime}</td>`;
    tbody.appendChild(tr);
  });

  qsa('canvas.circuitCanvas', tbody).forEach(c=>{
    const circ = c.dataset.circuit;
    const job = filtered.find(j=>j.circuit===circ);
    if(job) drawCircuit(c, job.circuit, job.qubits);
  });

  qs('#totalJobs').textContent = filtered.length;
  const st = {DONE:0,RUNNING:0,QUEUED:0,FAILED:0};
  filtered.forEach(j=>{ st[j.status]++; });
  qs('#doneCnt').textContent = st.DONE;
  qs('#runCnt').textContent = st.RUNNING;
  qs('#queueCnt').textContent = st.QUEUED;
  qs('#avgQueue').textContent = filtered.length? (filtered.reduce((a,j)=>a+j.queueMin,0)/filtered.length).toFixed(1):0;
}

async function openJobModal(jobId){
  const job = state.jobs.find(j=>j.id===jobId) || await api(`/jobs/${jobId}`);
  if(!job) return;
  qs('#jobModal').classList.add('open');
  qs('#jobModalTitle').textContent = job.id;
  qs('#jobModalSubtitle').textContent = `Backend: ${job.backend} | Status: ${job.status}`;
  qs('#jobMeta').innerHTML = `
    <div>User: ${job.user}</div>
    <div>Qubits: ${job.qubits}</div>
    <div>Status: ${job.status}</div>
    <div>Submitted: ${fmtDate(job.submitted)}</div>
    <div>Queue (min): ${job.queueMin}</div>
    <div>Runtime (s): ${job.runtime}</div>
    <div>Circuit: ${job.circuit}</div>`;
  qs('#jobResult').textContent = job.result? JSON.stringify(job.result,null,2):'Pending or failed';
  const modalCanvas = qs('#modalCircuit');
  drawCircuit(modalCanvas, job.circuit, job.qubits);
}

qs('#closeModal').onclick = ()=>qs('#jobModal').classList.remove('open');

qs('#refreshBtn').onclick = ()=>refresh();
qs('#search').oninput = e=>{ state.filters.search=e.target.value; renderJobs(); };
qs('#status').onchange = e=>{ state.filters.status=e.target.value; renderJobs(); };
qs('#backend').onchange = e=>{ state.filters.backend=e.target.value; renderJobs(); };

refresh();
</script>
</body>
</html>
