<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quantum Jobs Tracker</title>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #0f1621;
      --muted: #a3b3c6;
      --text: #e6eef8;
      --accent: #61dafb;
      --ok: #28a745;
      --warn: #e0a800;
      --err: #e5534b;
      --chip: #1b2636;
      --border: #1e2a3a;
      --shadow: 0 8px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 10% -10%, #122036 0%, #0b0f14 60%);
      color: var(--text);
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 20px; }
    .title { display: flex; align-items: center; gap: 12px; }
    .logo { width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #00d4ff, #0077ff); box-shadow: var(--shadow); }
    h1 { font-size: 22px; margin: 0; letter-spacing: .2px; }
    .sub { color: var(--muted); font-size: 13px; }

    .panel { background: linear-gradient(180deg, #111a27, #0d141f); border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); }
    .controls { display: grid; grid-template-columns: 1.2fr 1fr 1fr 1fr auto; gap: 12px; padding: 14px; align-items: center; }
    .controls .group { background: var(--chip); border: 1px solid var(--border); border-radius: 12px; display: flex; align-items: center; gap: 8px; padding: 8px 10px; }
    .controls input, .controls select { width: 100%; background: transparent; border: none; outline: none; color: var(--text); font-size: 14px; }
    .controls label { font-size: 12px; color: var(--muted); }

    .btn { background: linear-gradient(180deg, #1d2a3e, #172337); border: 1px solid var(--border); color: var(--text); padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; letter-spacing: .2px; }
    .btn:hover { filter: brightness(1.08); }

    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px; }
    @media (max-width: 980px){ .grid { grid-template-columns: 1fr; } .controls { grid-template-columns: 1fr 1fr 1fr; } }

    .stat-card { padding: 16px; display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; }
    .stat-title { color: var(--muted); font-size: 12px; }
    .stat-value { font-size: 28px; font-weight: 800; letter-spacing: .5px; }
    .chip { padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); background: var(--chip); font-size: 12px; color: var(--muted); display: inline-flex; gap: 6px; align-items: center; }

    .section { margin-top: 18px; display: grid; grid-template-columns: 1.1fr 2fr; gap: 16px; }
    @media (max-width: 980px){ .section { grid-template-columns: 1fr; } }

    .device-list { padding: 10px; }
    .device { display: grid; grid-template-columns: 1fr auto auto; gap: 10px; align-items: center; border-bottom: 1px dashed var(--border); padding: 12px 6px; }
    .device:last-child { border-bottom: none; }
    .device .name { font-weight: 600; }
    .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }

    .table-wrap { overflow: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid var(--border); padding: 12px 10px; text-align: left; font-size: 14px; }
    th { color: var(--muted); font-weight: 600; position: sticky; top: 0; background: #0e1623; }
    tr:hover td { background: rgba(255,255,255,.02); }

    .status { font-weight: 700; font-size: 12px; padding: 6px 8px; border-radius: 8px; display: inline-block; }
    .st-DONE { background: rgba(40,167,69,.1); color: var(--ok); border: 1px solid rgba(40,167,69,.3); }
    .st-RUNNING { background: rgba(0,123,255,.1); color: #4da3ff; border: 1px solid rgba(0,123,255,.3); }
    .st-QUEUED { background: rgba(224,168,0,.1); color: var(--warn); border: 1px solid rgba(224,168,0,.3); }
    .st-FAILED { background: rgba(229,83,75,.1); color: var(--err); border: 1px solid rgba(229,83,75,.3); }

    .right { text-align: right; }

    /* Modal */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,.6); display: none; align-items: center; justify-content: center; padding: 20px; }
    .modal.open { display: flex; }
    .modal-card { width: min(760px, 96vw); background: #0e1521; border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); }
    .modal-head { display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; border-bottom: 1px solid var(--border); }
    .modal-body { padding: 16px; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: #0b1120; border: 1px solid var(--border); color: #d9e5f7; padding: 2px 6px; border-radius: 6px; }

    /* Tiny bar chart */
    canvas { background: #0c121c; border: 1px solid var(--border); border-radius: 10px; }

    footer { margin-top: 18px; color: var(--muted); font-size: 12px; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Quantum Jobs Tracker</h1>
          <div class="sub">Monitor live/public IBM Quantum jobs • Problem ID: AQVH915</div>
        </div>
      </div>
      <button id="refreshBtn" class="btn">⟳ Refresh</button>
    </header>

    <div class="panel controls">
      <div class="group">
        <label for="search">Search</label>
        <input id="search" placeholder="Job ID, circuit, user…" />
      </div>
      <div class="group">
        <label for="status">Status</label>
        <select id="status">
          <option value="">Any</option>
          <option>QUEUED</option>
          <option>RUNNING</option>
          <option>DONE</option>
          <option>FAILED</option>
        </select>
      </div>
      <div class="group">
        <label for="backend">Backend</label>
        <select id="backend"><option value="">Any</option></select>
      </div>
      <div class="group">
        <label for="interval">Auto-refresh</label>
        <select id="interval">
          <option value="0">Off</option>
          <option value="10">10s</option>
          <option value="30">30s</option>
          <option value="60">60s</option>
        </select>
      </div>
      <div style="justify-self:end"><span class="chip" id="lastUpdated">Last updated: —</span></div>
    </div>

    <div class="grid">
      <div class="panel stat-card">
        <div>
          <div class="stat-title">Total Jobs (visible)</div>
          <div class="stat-value" id="totalJobs">0</div>
        </div>
        <div>
          <div class="chip">DONE: <span id="doneCnt">0</span></div>
          <div class="chip" style="margin-left:8px">RUNNING: <span id="runCnt">0</span></div>
          <div class="chip" style="margin-left:8px">QUEUED: <span id="queueCnt">0</span></div>
        </div>
      </div>
      <div class="panel stat-card">
        <div>
          <div class="stat-title">Average Queue (mins)</div>
          <div class="stat-value" id="avgQueue">0.0</div>
        </div>
        <div class="chip">Across backends</div>
      </div>
    </div>

    <div class="section">
      <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center; padding: 12px 14px; border-bottom:1px solid var(--border);">
          <strong>Backend Status</strong>
          <span class="chip">Devices: <span id="deviceCount">0</span></span>
        </div>
        <div class="device-list" id="deviceList"></div>
      </div>

      <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center; padding: 12px 14px; border-bottom:1px solid var(--border);">
          <strong>Jobs</strong>
          <span class="chip"><span class="dot" id="liveDot" style="background:#777"></span>&nbsp;Live</span>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Job ID</th>
                <th>Backend</th>
                <th>Status</th>
                <th class="right">Qubits</th>
                <th>Submitted</th>
                <th class="right">Queue (m)</th>
                <th class="right">Runtime (s)</th>
              </tr>
            </thead>
            <tbody id="jobsBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="panel" style="margin-top:16px; padding: 12px 14px;">
      <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
        <strong>Job Status Distribution</strong>
        <span class="chip">visual</span>
      </div>
      <canvas id="statusChart" width="900" height="220" aria-label="bar chart of job statuses"></canvas>
    </div>

    <footer>
      Built with vanilla HTML/CSS/JS. Uses mock data by default. Toggle a backend endpoint in code when ready.
    </footer>
  </div>

  <!-- Job Details Modal -->
  <div class="modal" id="jobModal" role="dialog" aria-modal="true" aria-labelledby="jobModalTitle">
    <div class="modal-card">
      <div class="modal-head">
        <div>
          <div id="jobModalTitle" style="font-weight:800">Job Details</div>
          <div class="sub" id="jobModalSubtitle">—</div>
        </div>
        <button class="btn" id="closeModal">✕ Close</button>
      </div>
      <div class="modal-body" id="jobModalBody">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div class="panel" style="padding:12px">
            <div class="stat-title">Job Metadata</div>
            <div id="jobMeta" style="margin-top:6px"></div>
          </div>
          <div class="panel" style="padding:12px">
            <div class="stat-title">Result Preview</div>
            <pre class="kbd" id="jobResult" style="white-space: pre-wrap; margin-top:6px;">—</pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ======== CONFIG ========
    // By default, the app uses a mock API so you can double‑click and run.
    // When you have a backend (e.g., /api) that proxies IBM Quantum API, set USE_BACKEND = true and adjust BASE_URL.
    const USE_BACKEND = false; // set to true when your backend is ready
    const BASE_URL = "/api";  // e.g., your FastAPI/Node proxy path

    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => Array.from(el.querySelectorAll(s));

    const fmtDate = ts => new Date(ts).toLocaleString();
    const minutes = ms => (ms/60000);

    const state = {
      jobs: [],
      devices: [],
      filters: { search: "", status: "", backend: "" },
      timer: null,
    };

    // ======== MOCK API (replace with real endpoints later) ========
    const MockAPI = {
      async listBackends(){
        await sleep(200);
        return [
          { name: "ibm_oslo", qubits: 5, status: "online", queue: randInt(0, 20) },
          { name: "ibm_perth", qubits: 7, status: "online", queue: randInt(0, 30) },
          { name: "ibmq_qasm_simulator", qubits: 32, status: "online", queue: randInt(0, 5) },
          { name: "ibm_kyoto", qubits: 127, status: Math.random()>.15?"online":"offline", queue: randInt(0, 120) },
        ];
      },
      async listJobs(){
        await sleep(300);
        // generate some deterministic-ish sample jobs on each call
        const backends = ["ibm_oslo","ibm_perth","ibmq_qasm_simulator","ibm_kyoto"];
        const statuses = ["QUEUED","RUNNING","DONE","FAILED"];
        const now = Date.now();
        return Array.from({length: 28}).map((_,i)=>{
          const backend = backends[i % backends.length];
          const status = statuses[(i*7 + randInt(0,3)) % statuses.length];
          const submitted = now - randInt(2, 180)*60*1000; // minutes ago
          const queueMin = status==="QUEUED" ? randInt(1, 60) : randInt(0, 5);
          const runtime = status==="DONE" ? randInt(2, 90) : (status==="FAILED" ? randInt(1,10) : 0);
          const qubits = backend==="ibm_kyoto"? randInt(20, 120) : backend==="ibmq_qasm_simulator"? randInt(5,32) : randInt(3,7);
          return {
            id: `JOB-${(100000+i+randInt(0,999)).toString(36).toUpperCase()}`,
            backend, status, qubits,
            submitted, queueMin, runtime,
            user: ["alice","bob","charlie","diana"][i%4],
            circuit: `circuit_${(i%9)+1}`,
            result: status==="DONE" ? { counts: sampleCounts(qubits) } : (status==="FAILED"? { error: "Device calibration drift" } : null)
          }
        });
      },
      async getJob(jobId){
        const list = await this.listJobs();
        return list.find(j=>j.id===jobId) || list[0];
      }
    };

    async function api(path){
      if(!USE_BACKEND){
        // map pseudo paths to mock api
        if(path==="/backends") return MockAPI.listBackends();
        if(path==="/jobs") return MockAPI.listJobs();
        if(path.startsWith("/job/")) return MockAPI.getJob(path.split("/").pop());
        return null;
      }
      const res = await fetch(`${BASE_URL}${path}`);
      if(!res.ok) throw new Error(`API ${path} ${res.status}`);
      return res.json();
    }

    // ======== RENDERING ========
    function renderDevices(){
      const list = qs('#deviceList');
      list.innerHTML = '';
      state.devices.forEach(d=>{
        const dot = `<span class="dot" style="background:${d.status==='online'?'#27d980':'#ff6b6b'}"></span>`;
        list.insertAdjacentHTML('beforeend', `
          <div class="device">
            <div>
              <div class="name">${d.name}</div>
              <div class="sub">${d.qubits} qubits</div>
            </div>
            <div>${dot} <span class="sub">${d.status}</span></div>
            <div class="chip">Queue: ${d.queue}</div>
          </div>
        `);
      });
      qs('#deviceCount').textContent = state.devices.length;

      // fill backend filter
      const sel = qs('#backend');
      const cur = sel.value;
      sel.innerHTML = '<option value="">Any</option>' + state.devices.map(d=>`<option>${d.name}</option>`).join('');
      if([...sel.options].some(o=>o.value===cur)) sel.value = cur;
    }

    function renderJobs(){
      const body = qs('#jobsBody');
      body.innerHTML = '';
      const { search, status, backend } = state.filters;
      const filtered = state.jobs.filter(j => {
        const matchText = (j.id + ' ' + j.user + ' ' + j.circuit).toLowerCase().includes(search.toLowerCase());
        const matchStatus = !status || j.status===status;
        const matchBackend = !backend || j.backend===backend;
        return matchText && matchStatus && matchBackend;
      });

      filtered.forEach(j => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><a href="#" data-job="${j.id}" class="jobLink">${j.id}</a></td>
          <td>${j.backend}</td>
          <td><span class="status st-${j.status}">${j.status}</span></td>
          <td class="right">${j.qubits}</td>
          <td>${fmtDate(j.submitted)}</td>
          <td class="right">${j.queueMin}</td>
          <td class="right">${j.runtime}</td>
        `;
        body.appendChild(row);
      });

      // stats
      qs('#totalJobs').textContent = filtered.length;
      qs('#doneCnt').textContent = filtered.filter(j=>j.status==='DONE').length;
      qs('#runCnt').textContent = filtered.filter(j=>j.status==='RUNNING').length;
      qs('#queueCnt').textContent = filtered.filter(j=>j.status==='QUEUED').length;
      qs('#avgQueue').textContent = (filtered.reduce((a,b)=>a+b.queueMin,0)/Math.max(1,filtered.length)).toFixed(1);

      // bind job links
      qsa('a.jobLink', body).forEach(a=>a.addEventListener('click', async (e)=>{
        e.preventDefault();
        openJobModal(a.dataset.job);
      }));

      renderChart(filtered);
    }

    function renderChart(jobs){
      const canvas = qs('#statusChart');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width,canvas.height);

      const counts = ['QUEUED','RUNNING','DONE','FAILED'].map(s=>({ s, c: jobs.filter(j=>j.status===s).length }));
      const max = Math.max(1, ...counts.map(x=>x.c));
      const pad = { t: 20, r: 20, b: 30, l: 40 };
      const bw = 80, gap = 30;
      const baseY = canvas.height - pad.b;
      counts.forEach((x,i)=>{
        const h = (x.c/max) * (canvas.height - pad.t - pad.b);
        const x0 = pad.l + i*(bw+gap);
        const y0 = baseY - h;
        // bar
        ctx.fillStyle = '#1f3b6a';
        ctx.strokeStyle = '#264c86';
        ctx.lineWidth = 2;
        ctx.fillRect(x0, y0, bw, h);
        ctx.strokeRect(x0, y0, bw, h);
        // label
        ctx.fillStyle = '#9fb3cc';
        ctx.font = '12px system-ui';
        ctx.fillText(x.s, x0+8, baseY+16);
        ctx.fillText(String(x.c), x0+bw/2-4, y0-6);
      });
      // y axis
      ctx.strokeStyle = '#2a3a55';
      ctx.beginPath(); ctx.moveTo(pad.l, pad.t-10); ctx.lineTo(pad.l, baseY); ctx.stroke();
    }

    // ======== JOB MODAL ========
    async function openJobModal(jobId){
      const job = state.jobs.find(j=>j.id===jobId) || await api(`/job/${jobId}`);
      qs('#jobModalTitle').textContent = job.id;
      qs('#jobModalSubtitle').textContent = `${job.backend} • ${job.status}`;
      qs('#jobMeta').innerHTML = `
        <div><span class="sub">User</span><div class="kbd">${job.user}</div></div>
        <div style="height:8px"></div>
        <div><span class="sub">Circuit</span><div class="kbd">${job.circuit}</div></div>
        <div style="height:8px"></div>
        <div class="sub">Submitted</div><div class="kbd">${fmtDate(job.submitted)}</div>
        <div style="height:8px"></div>
        <div class="sub">Queue (mins)</div><div class="kbd">${job.queueMin}</div>
        <div style="height:8px"></div>
        <div class="sub">Runtime (s)</div><div class="kbd">${job.runtime}</div>
        <div style="height:8px"></div>
        <div class="sub">Qubits</div><div class="kbd">${job.qubits}</div>
      `;
      qs('#jobResult').textContent = job.result ? JSON.stringify(job.result, null, 2) : '—';
      qs('#jobModal').classList.add('open');
    }

    qs('#closeModal').addEventListener('click', ()=> qs('#jobModal').classList.remove('open'));
    qs('#jobModal').addEventListener('click', (e)=>{ if(e.target.id==='jobModal') qs('#jobModal').classList.remove('open'); });

    // ======== DATA FLOW ========
    async function refresh(){
      setLive(true);
      const [devices, jobs] = await Promise.all([
        api('/backends'),
        api('/jobs')
      ]);
      state.devices = devices;
      state.jobs = jobs;
      renderDevices();
      renderJobs();
      qs('#lastUpdated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
      setLive(false);
    }

    function setLive(isLive){
      qs('#liveDot').style.background = isLive ? '#27d980' : '#777';
    }

    // ======== HELPERS ========
    function sleep(ms){ return new Promise(res=>setTimeout(res, ms)); }
    function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
    function sampleCounts(q){
      // produce a tiny fake counts dict like {"00": 512, "11": 500}
      const keys = ["00","01","10","11"].slice(0, Math.min(4, Math.max(2, Math.round(Math.log2(q)) )));
      const values = keys.map(()=>randInt(100, 700));
      const obj = {}; keys.forEach((k,i)=>obj[k]=values[i]);
      return obj;
    }

    // ======== EVENTS ========
    qs('#search').addEventListener('input', (e)=>{ state.filters.search = e.target.value; renderJobs(); });
    qs('#status').addEventListener('change', (e)=>{ state.filters.status = e.target.value; renderJobs(); });
    qs('#backend').addEventListener('change', (e)=>{ state.filters.backend = e.target.value; renderJobs(); });

    qs('#refreshBtn').addEventListener('click', refresh);

    qs('#interval').addEventListener('change', (e)=>{
      const sec = Number(e.target.value);
      if(state.timer) clearInterval(state.timer), state.timer = null;
      if(sec>0){ state.timer = setInterval(refresh, sec*1000); }
    });

    // ======== INIT ========
    (async function init(){ await refresh(); })();
  </script>
</body>
</html>
